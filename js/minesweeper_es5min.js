"use strict";var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _OPTIONS_={difficulty:0,grids:[[9,9,10],[16,16,50],[30,16,99]]},MineSweeper=function(){function a(b){_classCallCheck(this,a),this.options=b,this.animationframe=0,this.timer=document.getElementById("timer"),this.timewon=document.getElementById("timewon"),this.remaining=document.getElementById("flagCount"),this.msgWon=document.getElementById("msgWon"),this.msgLost=document.getElementById("msgLost"),this.board=[],this.resetGrid()}return _createClass(a,[{key:"resetGrid",value:function resetGrid(){this.board=[],this.list=[[]],this.flagCount=0,this.timeValue=0,this.msgWon.hidden=!0,this.msgLost.hidden=!0,smileyUnDead()}},{key:"buildGrid",value:function buildGrid(){this.resetGrid();var b=document.getElementById("minefield");b.innerHTML="";var c=this.options.grids[this.options.difficulty][0],d=this.options.grids[this.options.difficulty][1];this.list=Array(c);for(var f=0;f<=c;f++)this.list[f]=Array(d);for(var g=void 0,h=0;h<d;h++)for(var j=0;j<c;j++)g=new Mine,g.position={x:j,y:h},this.list[j][h]=g,g=g.elementRef,b.appendChild(g);var k=window.getComputedStyle(g),l=parseInt(k.width.slice(0,-2)),m=parseInt(k.height.slice(0,-2));b.style.width=c*l+"px",b.style.height=d*m+"px"}},{key:"checkRemaining",value:function checkRemaining(){for(var d=this.options.grids[this.options.difficulty][0],f=this.options.grids[this.options.difficulty][1],g=0,h=0,b=0;b<f;b++)for(var c=0;c<d;c++)this.list[c][b].state.revealed&&g++,this.list[c][b].state.mine&&h++;var j=this.options.grids[this.options.difficulty][0]*this.options.grids[this.options.difficulty][1]-1;g+h==j&&(cancelAnimationFrame(this.animationframe),smileyWon(),this.msgWon.hidden=!1)}},{key:"gameOver",value:function gameOver(){cancelAnimationFrame(this.animationframe),smileyDead(),this.msgLost.hidden=!1}},{key:"revealGrid",value:function revealGrid(b,c){var d=2<arguments.length&&void 0!==arguments[2]&&arguments[2],f=this.options.grids[this.options.difficulty][1],g=this.options.grids[this.options.difficulty][0];if(!(0>b||b==this.list.length-1||c==this.list[0].length||0>c||b>g||c>f)){var h=this.list[b][c];if(!h.state.revealed){if(this.checkRemaining(),!d){if(h.state.flagged||h.state.revealed)return;if(h.state.mine)return h.state.revealed=!0,h.state.explode=!0,void this.gameOver(h)}else{if(h.state.flagged||h.state.mine)return;if(0==h.state.adjacent)return}h.state.revealed=!0;this.list.length-1;f=this.list[0].length-1,d?!1==h.state.mine&&(Game.field.revealGrid(b-1,c),Game.field.revealGrid(b+1,c),Game.field.revealGrid(b,c+1),Game.field.revealGrid(b,c-1)):0==h.state.adjacent&&!1==h.state.mine&&(Game.field.revealGrid(b-1,c),Game.field.revealGrid(b+1,c),Game.field.revealGrid(b,c+1),Game.field.revealGrid(b,c-1)),h.update()}}}},{key:"increaseWarning",value:function increaseWarning(b,c){var d=this.list.length-1,f=this.list[0].length-1;if(!(0>c||0>b)&&!(c>d||b>f)){var g=this.list[c][b];!g||g.state.mine||(g.state.adjacent++,g.update())}}},{key:"startTimer",value:function startTimer(){var b=this;this.timeValue=0,cancelAnimationFrame(this.animationframe),this.animationframe=requestAnimationFrame(function(){b.onTimerTick()})}},{key:"onTimerTick",value:function onTimerTick(){this.timeValue+=1/60,this.updateTimer()}},{key:"updateTimer",value:function updateTimer(){var b=this;this.timer.innerHTML=Math.round(this.timeValue),this.timewon.innerHTML=Math.round(this.timeValue),this.animationframe=requestAnimationFrame(function(){b.onTimerTick()})}}]),a}(),Game=function(){function a(){_classCallCheck(this,a),this.field=new MineSweeper(_OPTIONS_)}return _createClass(a,[{key:"handleSetDifficulty",value:function handleSetDifficulty(b){this.field.options.difficulty=b.target.value,this.field.buildGrid()}},{key:"handleStartGame",value:function handleStartGame(){this.field.buildGrid()}}]),a}();document.addEventListener("DOMContentLoaded",function(){Game=new Game});var time=0,tileIdCount=0,Mine=function(){function a(){_classCallCheck(this,a),this.elementRef=this.createTile(),this.hasChecked=!1,this.id=tileIdCount++,this.state={revealed:!1,flagged:!1,adjacent:0,mine:!1}}return _createClass(a,[{key:"createTile",value:function createTile(){var c=this,b=document.createElement("div");return b.classList.add("tile"),b.classList.add("hidden"),b.addEventListener("auxclick",function(d){d.preventDefault()}),b.addEventListener("contextmenu",function(d){d.preventDefault()}),b.addEventListener("mouseup",function(d){c.handleTileClick(d)}),b}},{key:"handleTileClick",value:function handleTileClick(b){var u=this;if(Game.field.msgWon.hidden&&Game.field.msgLost.hidden){if(0==Game.field.timeValue){Game.field.startTimer();var d=document.getElementById("minefield");d.innerHTML="";var f=Game.field.options.grids[Game.field.options.difficulty][0],g=Game.field.options.grids[Game.field.options.difficulty][1];this.list=Array(f);for(var h=0;h<=f;h++)this.list[h]=Array(g);console.log(this.list);for(var j=void 0,k=0;k<g;k++)for(var l=0;l<f;l++){j=new a,j.position={x:l,y:k},Game.field.list[l][k]=j;var m=j.elementRef;d.appendChild(m),j.update()}for(var c=0;c<Game.field.options.grids[Game.field.options.difficulty][2];c++){var o=Math.round(Math.random()*f),p=Math.round(Math.random()*g);this.position.x==o&&this.position.y==p&&(o+=Math.round(4*Math.random()),p+=Math.round(4*Math.random()));var q=Game.field.list[o][p];q&&!1==q.state.mine&&(q.state.mine=!0,q.update(),Game.field.increaseWarning(p-1,o-1),Game.field.increaseWarning(p-1,o),Game.field.increaseWarning(p-1,o+1),Game.field.increaseWarning(p,o-1),Game.field.increaseWarning(p,o),Game.field.increaseWarning(p+1,o),Game.field.increaseWarning(p,o+1),Game.field.increaseWarning(p+1,o-1),Game.field.increaseWarning(p+1,o+1));continue}return void Game.field.revealGrid(this.position.x,this.position.y)}if(1===b.which)Game.field.revealGrid(this.position.x,this.position.y);else if(2===b.which){var r=0;if(1>this.state.adjacent||!this.state.revealed||this.state.flagged)return;var s=[],t=function(v,w){s.push(Game.field.list[u.position.x+v][u.position.y+w]),!0==Game.field.list[u.position.x+v][u.position.y+w].state.flagged&&r++};if(t(-1,-1),t(-1,0),t(-1,1),t(0,-1),t(0,0),t(1,0),t(0,1),t(1,-1),t(1,1),this.state.adjacent!==r)return;s.forEach(function(v){v.state.revealed=!0,v.state.flagged||(v.state.mine&&(v.state.explode=!0),v.update(),Game.field.gameOver())})}else 3===b.which&&(this.state.revealed||((this.state.flagged=!this.state.flagged)?Game.field.flagCount++:-Game.field.flagCount--));this.update(),Game.field.remaining.innerHTML=Math.round(Game.field.options.grids[Game.field.options.difficulty][2]-Game.field.flagCount)}}},{key:"update",value:function update(){this.elementRef.className=this.state.explode?"tile mine_hit":this.state.mine&&this.state.revealed?"tile mine":this.state.flagged?"tile flag":this.state.revealed?this.state.adjacent?"tile tile_"+this.state.adjacent:"tile":"tile hidden"}}]),a}();function smileyDown(){var a=document.getElementById("smiley");a.classList.add("face_down"),a.classList.remove("face_limbo")}function smileyUp(){var a=document.getElementById("smiley");a.classList.remove("face_down"),a.classList.remove("face_win")}function smileyDead(){var a=document.getElementById("smiley");a.classList.add("face_lose"),a.classList.remove("face_down"),a.classList.remove("face_limbo")}function smileyWon(){var a=document.getElementById("smiley");a.classList.add("face_win"),a.classList.remove("face_down"),a.classList.remove("face_limbo")}function smileyUnDead(){var a=document.getElementById("smiley");a.classList.remove("face_lose"),a.classList.remove("face_win")}function smileyLimbo(){var a=document.getElementById("smiley");a.classList.add("face_limbo")}function smileyLimboRemove(){var a=document.getElementById("smiley");a.classList.remove("face_down"),a.classList.remove("face_limbo")}
